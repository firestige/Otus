# capture-agent UAS sidecar configuration
# The `capture-agent:` root key is required — config.go unmarshals into configRoot{CaptureAgent: ...}

capture-agent:
  node:
    hostname: uas          # must match Kafka command `target` field (or use "*" to broadcast)
    role: UAS              # SimpleCommand role — used by task_start / task_stop
    tags:
      datacenter: voip-simulator
      environment: dev

  control:
    socket: /tmp/capture-agent.sock
    pid_file: /tmp/capture-agent.pid

  metrics:
    enabled: true
    listen: :9091

  # Global Kafka defaults (inherited by command_channel and reporters via ADR-024)
  # Use IP instead of hostname to avoid DNS failure when Docker network is reconfigured
  kafka:
    brokers:
      - 172.20.0.30:9092

  command_channel:
    enabled: true
    type: kafka
    command_ttl: 5m
    kafka:
      topic: capture-agent-uas-commands
      response_topic: "capture-agent-responses"
      group_id: capture-agent-uas
      auto_offset_reset: earliest

  reporters:
    kafka:
      compression: snappy
      max_message_bytes: 1048576

  log:
    level: debug
    format: text

  # ── Role-based task defaults (used by task_start / SimpleCommand) ──
  roles:
    UAS:
      workers: 1
      capture:
        name: afpacket
        config:
          iface: eth0
          buffer_size_mb: 16
          bpf_filter: ""   # auto-generated from portRange + protocol
      decoder:
        ip_defrag: true
        tcp_reassembly: true
        transport:
          ipip: false
        ip_reassembly:
          timeout: 30s
          max_fragments: 5000
      parsers:
        - name: sip
          config: {}
        - name: rtp
          config: {}
      processors: []
      reporters:
        - name: kafka
          config:
            topic: capture-agent-uas-logs
            brokers:
              - 172.20.0.30:9092
            serialization: json
